variables:
  GOBIN:  '$(GOPATH)/bin' # Go binaries path
  GOROOT: '/usr/local/go1.12' # Go installation path
  GOPATH: '$(system.defaultWorkingDirectory)/gopath' # Go workspace path
  modulePath: '$(GOPATH)/src/github.com/$(build.repository.name)' # Path to the module's code
  wd: '$(modulePath)/integrationTest'

trigger:
  batch: "true"
  branches:
    include:
    - pipeline

jobs:



# - job: Route53
#   steps:
#   - template: go-env.yaml
#   - script: go test -v -verbose -provider ROUTE53
#     workingDirectory: $(wd)
#     env:
#       # these are defined in azure pipelines web ui as secret variables
#       R53_DOMAIN: $(R53_DOMAIN)
#       R53_KEY_ID: $(R53_KEY_ID)
#       R53_KEY: $(R53_KEY)
      
# - job: GCloud
#   steps:
#   - template: go-env.yaml
#   - script: go test -v -verbose -provider GCLOUD
#     workingDirectory: $(wd)
#     env:
#       GCLOUD_DOMAIN: $(GCLOUD_DOMAIN)
#       GCLOUD_TYPE: $(GCLOUD_TYPE)
#       GCLOUD_EMAIL: $(GCLOUD_EMAIL)
#       GCLOUD_PROJECT: $(GCLOUD_PROJECT)
#       GCLOUD_PRIVATEKEY: $(GCLOUD_PRIVATEKEY)

- job: RunTests
  strategy:
    matrix: 
      # this matrix maps secrets stored in azure pipelines project variables into local pipeline variables
      NameDotCom:
        Provider: NAMEDOTCOM
        V_NAMEDOTCOM_DOMAIN: $(NAMEDOTCOM_DOMAIN)
        V_NAMEDOTCOM_URL: $(NAMEDOTCOM_URL)
        V_NAMEDOTCOM_KEY: $(NAMEDOTCOM_KEY)
        V_NAMEDOTCOM_USER: $(NAMEDOTCOM_USER)
  steps:
  - template: go-env.yaml
  - script: go test -v -verbose -provider $(Provider)
    workingDirectory: $(wd)
    env:
      # list all possible env vars here. only the ones specifically mapped into each step of the matrix will be populated
      NAMEDOTCOM_DOMAIN: $(V_NAMEDOTCOM_DOMAIN)
      NAMEDOTCOM_URL: $(V_NAMEDOTCOM_URL)
      NAMEDOTCOM_KEY: $(V_NAMEDOTCOM_KEY)
      NAMEDOTCOM_USER: $(V_NAMEDOTCOM_USER)

# - job: Cloudflare
#   steps:
#   - template: go-env.yaml
#   - script: go test -v -verbose -provider CLOUDFLAREAPI
#     workingDirectory: $(wd)
#     env:
#       CF_DOMAIN: $(CF_DOMAIN)
#       CF_KEY: $(CF_KEY)
#       CF_USER: $(CF_USER)