variables:
  GOBIN:  '$(GOPATH)/bin' # Go binaries path
  GOROOT: '/usr/local/go1.12' # Go installation path
  GOPATH: '$(system.defaultWorkingDirectory)/gopath' # Go workspace path
  modulePath: '$(GOPATH)/src/github.com/$(build.repository.name)' # Path to the module's code

trigger:
  batch: "true"
  branches:
    include:
    - pipeline

jobs:

- job: RunIntegrationTests
  strategy:
    maxParallel: 3
    matrix: 
      R53:
        Provider: ROUTE53
  steps:
  - template: go-env.yaml
  - script: |
      echo $R53_DOMAIN | base64
      #go test -v -verbose -provider $(Provider)
      
    workingDirectory: '$(modulePath)/integrationTest'
    env:
      # these are defined in azure pipelines web ui as secret variables
      R53_DOMAIN: $(R53_DOMAIN)
      R53_KEY_ID: $(R53_KEY_ID)
      R53_KEY: $(R53_KEY)_

